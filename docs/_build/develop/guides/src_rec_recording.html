
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MEG recording specific model computation &#8212; FiNN  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/_rst_properties.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'guides/src_rec_recording';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MEG recording agnostic model computation" href="src_rec_subject.html" />
    <link rel="prev" title="MEG recording agnostic model computation" href="src_rec_device.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">FiNN  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install_guide.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guides.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../install_guide.html">
                        Installation
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="../guides.html">
                        Guides
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api_reference.html">
                        API reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><h3><a href="../index.html">FiNNPY</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install_guide.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#automatic-install">1. Automatic install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#manual-build">2. Manual build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install_guide.html#installing-r-enabling-statistics">3. Installing R &amp; enabling statistics</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../guides.html">Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../guides.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#data-preparation">Data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#feature-generation">Feature generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guides.html#source-reconstruction">Source reconstruction</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../guides.html#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../basic.html">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cfc.html">Cross frequency connectivity (cfc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cleansing.html">Cleansing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../file_io.html">File IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../filters.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../misc.html">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sfc.html">Same frequency coupling (sfc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../src_rec.html">Source reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statistical.html">Statistical</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualization.html">Visualization</a></li>
</ul>
</li>
</ul>

</div>
        <div class="sidebar-primary-item">
<h3>Versions</h3>
<ul>
  <div class="injected">
    <p>Branches</p>
    <div class="dropdown-content">
      <div class="">
        <a href="../../0.1.5/index.html">0.1.5</a>
      </div>
      <div class="">
        <a href="../../1.4.0/index.html">1.4.0</a>
      </div>
      <div class="rtd-current-item">
        <a href="../../develop/index.html">develop</a>
      </div>
      <div class="">
        <a href="../../stable/index.html">stable</a>
      </div>
    </div>
  </div>
</ul>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../guides.html" class="nav-link">Guides</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">MEG...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="meg-recording-specific-model-computation">
<span id="src-rec-recording-label"></span><h1>MEG recording specific model computation<a class="headerlink" href="#meg-recording-specific-model-computation" title="Link to this heading">#</a></h1>
<p>This part of the guide explains how the recording specific part of the MEG source reconstruction is computed. After hereon, the model is specified towards a distinct MEG recording (MEG markers/fiducials). As such, if there are multiple sessions for a single subject, the output of the previous step (<a class="reference internal" href="../source/guides/src_rec_subject.html#src-rec-subject-label"><span class="std std-ref">MEG recording agnostic model computation</span></a>) may be used for multiple MEG sessions to avoid recomputing.</p>
<p>Important note if the following code is to be externally parallelized: Numpy auto-parallelizes specific functions. This behavior must be deactivated, if external parallelization is to be applied. This may be achieved with the following code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threadpoolctl</span>
<span class="n">threadpoolctl</span><span class="o">.</span><span class="n">threadpool_limits</span><span class="p">(</span><span class="n">limits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_api</span><span class="o">=</span><span class="s1">&#39;blas&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Herein, the individual commands of this section will be explained in a step-by-step fashion. The full pipeline looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mne</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.coreg</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.skull_skin_mdls</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.bem_mdl</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.cort_mdl</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.fwd_mdl</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.sen_cov</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.inv_mdl</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.subj_to_fsavg</span>

<span class="n">rec_meta_info</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="n">coreg</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">coreg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">subj_name</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">)</span>

<span class="n">skull_skin_mdls</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="s2">&quot;MEG&quot;</span><span class="p">,</span> <span class="n">coreg</span><span class="p">)</span>
<span class="n">bem_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">bem_mdl</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">in_skull_vert</span><span class="p">,</span> <span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">in_skull_faces</span><span class="p">)</span>
<span class="n">cort_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">cort_mdl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">bem_mdl</span><span class="o">.</span><span class="n">vert</span><span class="p">)</span>

<span class="n">fwd_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">fwd_mdl</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">,</span> <span class="n">bem_model</span><span class="p">)</span>
<span class="n">fwd_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">fwd_mdl</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">fwd_sol</span><span class="p">,</span> <span class="n">coreg</span><span class="p">)</span>
<span class="n">sen_cov</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">sen_cov</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">cov_path</span><span class="p">)</span>
<span class="n">inv_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">inv_mdl</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">sen_cov</span><span class="p">,</span> <span class="n">fwd_mdl</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">)</span>

<span class="n">subj_to_fsavg_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">subj_to_fsavg</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">fs_path</span><span class="p">)</span>
</pre></div>
</div>
<p>If not done previously, FreeSurfer needs to be initialized.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rec_meta_info</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="n">coreg</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">coreg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">subj_name</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">)</span>
</pre></div>
</div>
<p>The first step is to compute a coregistration between the MEG and the MRI recordings. <em>subj_name</em> indicates the name of a specific subject while the <em>anatomy_path</em> points towards the anatomy of <em>all</em> subjects. Finally, <em>rec_meta_info</em> is derived via mne.io.read_info from a specific MEG recording, querying MEG registration points (fiducials).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">skull_skin_mdls</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="s2">&quot;MEG&quot;</span><span class="p">,</span> <span class="n">coreg</span><span class="p">)</span>
<span class="n">bem_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">bem_mdl</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">in_skull_vert</span><span class="p">,</span> <span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">in_skull_faces</span><span class="p">)</span>
<span class="n">cort_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">cort_mdl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">bem_mdl</span><span class="o">.</span><span class="n">vert</span><span class="p">)</span>
</pre></div>
</div>
<p>Afterwards, the previously extracted skull and skin models are loaded and scaled as identified through the coregistration. While the skull and skin models present the informational bases for the construction of BEM models, cortical models are read (and scaled) from freesurfer extracted files.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fwd_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">fwd_mdl</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">coreg</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">,</span> <span class="n">bem_model</span><span class="p">)</span>
<span class="n">fwd_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">fwd_mdl</span><span class="o">.</span><span class="n">restrict</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">fwd_sol</span><span class="p">,</span> <span class="n">coreg</span><span class="p">)</span>
</pre></div>
</div>
<p>Importantly, coregistration results should be manually verified:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rec_meta_info</span> <span class="o">=</span> <span class="n">mne</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_info</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="n">meg_ref_pts</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">coreg</span><span class="o">.</span><span class="n">load_meg_ref_pts</span><span class="p">(</span><span class="n">rec_meta_info</span><span class="p">)</span>
<span class="p">(</span><span class="n">coreg</span><span class="p">,</span> <span class="n">bad_hsp_pts</span><span class="p">)</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">coreg</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">subj_name</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">)</span>
<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">coreg</span><span class="o">.</span><span class="n">plot_coregistration</span><span class="p">(</span><span class="n">coreg</span><span class="p">,</span> <span class="n">meg_ref_pts</span><span class="p">,</span> <span class="n">bad_hsp_pts</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>BEM and cortical models are used in the computation of the forward model. This model describes how cortical data projects into sensor space (the inverse of the desired model). Afterwards, the MEG model may be restricted, limiting bipoles to an surface orthogonal orientation. This restriction effectively enforces a simplification of the model.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">inv_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">inv_mdl</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">sen_cov</span><span class="p">,</span> <span class="n">fwd_mdl</span><span class="p">,</span> <span class="n">rec_meta_info</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, the model is inverted, describing how activity recorded in sensor space may have looked like in sensor space.</p>
<p>Additionally, one may want to compute a transformation from subject specific source space into fs-average source space to simplify group level analyses. As such, the corresponding model may be computed as follows.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subj_to_fsavg_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">subj_to_fsavg</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">cort_mdl</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">fs_path</span><span class="p">)</span>
</pre></div>
</div>
<p>This concludes the recording specific part of the MEG source reconstruction pipeline. The next step (the model’s application) is explained in <a class="reference internal" href="../source/guides/src_rec_apply.html#src-rec-apply-label"><span class="std std-ref">Model application</span></a>.</p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="src_rec_device.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MEG recording agnostic model computation</p>
      </div>
    </a>
    <a class="right-next"
       href="src_rec_subject.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MEG recording agnostic model computation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/guides/src_rec_recording.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022, Maximilian Scherer.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>