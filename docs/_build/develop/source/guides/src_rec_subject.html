
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MEG recording agnostic model computation &#8212; FiNN  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/_rst_properties.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/badge_only.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/_rtd_versions.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'source/guides/src_rec_subject';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">FiNN  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../install_guide.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../guides.html">
    Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api_reference.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../install_guide.html">
    Installation
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../guides.html">
    Guides
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api_reference.html">
    API reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
        <div class="sidebar-primary-item"><h3><a href="../../index.html">FiNNPY</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install_guide.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../install_guide.html#automatic-install">1. Automatic install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install_guide.html#manual-build">2. Manual build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../install_guide.html#installing-r-enabling-statistics">3. Installing R &amp; enabling statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../guides.html">Guides</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../guides.html#general">General</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides.html#data-preparation">Data preparation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides.html#feature-generation">Feature generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides.html#source-reconstruction">Source reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../guides.html#statistics">Statistics</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference.html">API reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../basic.html">Basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cfc.html">Cross frequency connectivity (cfc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../cleansing.html">Cleansing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../file_io.html">File IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../filters.html">Filters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../misc.html">Misc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../sfc.html">Same frequency coupling (sfc)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../src_rec.html">Source reconstruction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../statistical.html">Statistical</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../visualization.html">Visualization</a></li>
</ul>
</li>
</ul>

</div>
        <div class="sidebar-primary-item"><div class="injected">
  <div class="rst-versions " data-toggle="rst-versions" role="note"
    aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">&nbsp;&nbsp;Other versions&nbsp;&nbsp;</span>
      v: develop
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Branches</dt>
        <dd class="rtd-current-item">
          <a href="../../../develop/index.html">develop</a>
        </dd>
        <dd class="">
          <a href="../../../stable/index.html">stable</a>
        </dd>
      </dl>
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            <form id="flyout-search-form" class="wy-form" target="_blank" action="../../
              ../develop/index.html/../search.html" method="get">
              <input type="text" name="q" aria-label="Search docs" placeholder="Search docs">
            </form>
          </div>
        </dd>
      </dl>
    </div>
  </div>
</div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">MEG...</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="meg-recording-agnostic-model-computation">
<span id="src-rec-subject-label"></span><h1>MEG recording agnostic model computation<a class="headerlink" href="#meg-recording-agnostic-model-computation" title="Link to this heading">#</a></h1>
<p>This part of the guide explains how the subject specific components of the MEG source reconstruction are computed. This model is not specified towards a distinct MEG recording (MEG markers).</p>
<p>Herein, the individual commands of this section will be explained in a step-by-step fashion. Importantly, this code block may easily be parallelized externally across individual subjects, for example employing finnpys timed pool (finnpy.misc.timed_pool). Thereby, processing time may be reduced from approx. 2-4 hours x subjects to 2-4 hours total.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">finnpy.src_rec.freesurfer</span>
<span class="kn">import</span> <span class="nn">finnpy.src_rec.subj_to_fsavg</span>

<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">init_fs_paths</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">fs_path</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">t1_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">t1_path</span><span class="p">)):</span>
  <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">extract_mri_anatomy</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">t1_scan_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">copy_fsavg_anatomy</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">extract_skull_skin</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subject_name</span><span class="p">,</span> <span class="n">preflood_height</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">calc_head_model</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>

<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">subj_to_fsavg</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Initially, free surfer paths need to be configured for subsequent FreeSurfer calls.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy_sr_utils</span><span class="o">.</span><span class="n">init_fs_paths</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">)</span>
</pre></div>
</div>
<p><em>fs_path</em> points towards the FreeSurfer installation. The FreeSurfer folder should contain the ‘bin’ folder, license.txt, and sources.sh (among other files/directories).
<em>anatomy_path</em> contains sub-folders with anatomy folders for all subjects. FreeSurfer will fail if a subjects folder already exists.</p>
<p>Important: The T1 scan to be used for the extract must be placed outside the anatomy folder, otherwise FreeSurfer will not a process a subject who already maintains a subfolder in the anatomy directory.</p>
<p>As such, FiNN adheres to the following, FreeSurfer aligned, organizational structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>project_data
└── anatomy_path
    ├── subject_a (must be created via FreeSurfer, *do not create this folder manually*)
    │   ├── bem (automatically generated at later steps)
    │   │   └── watershed (automatically generated at later steps)
    │   ├── mri (automatically generated at later steps)
    │   │   └── transforms (automatically generated at later steps)
    │   ├── proj (automatically generated at later steps)
    │   └── surf (automatically generated at later steps)
    └── subject_b
</pre></div>
</div>
<p>The above command may look as follows on a Windows machine.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy_sr_utils</span><span class="o">.</span><span class="n">init_fs_paths</span><span class="p">(</span><span class="n">anatomy_path</span> <span class="o">=</span> <span class="s2">&quot;C:/.../anatomry/&quot;</span><span class="p">,</span>
                                 <span class="n">fs_path</span> <span class="o">=</span> <span class="s2">&quot;C:/.../FreeSurfer/version/&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Be aware that the <em>anatomy_path</em> variable in this initialization step must point towards the directory of <em>all</em> subjects, not a specific one.
After this initial setup, FreeSurfer may be used to either extract anatomical information from subject specific MRI scans or copy data from fs-average, an averaged MRI scan provided through FreeSurfer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">t1_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">t1_path</span><span class="p">)):</span>
  <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">extract_mri_anatomy</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">t1_scan_file</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">copy_fsavg_anatomy</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s take a closer look at this code example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">t1_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">t1_path</span><span class="p">)):</span>
</pre></div>
</div>
<p>Initially, it is checked whether the <em>t1_path</em> variable is not None and whether the indicated directory does actually exist. If this is the case, the following line is executed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">extract_mri_anatomy</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="n">t1_scan_file</span><span class="p">,</span> <span class="n">fiducials_file</span><span class="p">,</span> <span class="n">fiducials_path</span><span class="p">)</span>
</pre></div>
</div>
<p><em>fiducials_file</em> and <em>fiducials_path</em> may be employed to include subject specific fiducials, otherwise these will be compute from <em>fsaverage</em>. Finally, the <em>overwrite</em> flag may be used to allow overwriting a subject’s folder. As such, herein anatomy is extracted from a T1 scan. Be aware, this process may likely take several hours to run (reference: linux on a 5950X - 1.5 h - 4 h). Therefore, it is highly recommended to execute this command for several subjects in parallel.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">copy_fsavg_anatomy</span><span class="p">(</span><span class="n">fs_path</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>This line of code copies reference anatomy from <em>fsaverage</em> into the folder indicated by <em>subj_name</em>. <em>fsaverage</em> is provided by FreeSurfer and found in <em>FreeSurfer/version/subjects/</em> or <em>FreeSurfer/subjects/</em></p>
<p>Either of the above steps will create the following folders, <em>bem</em>, <em>bem/watershed</em>, <em>mri</em>, <em>mri/transforms</em>, <em>surf</em>, and partially populate these.</p>
<p>The next step is to extract skull and skin models. These are extracted using freesurfers watershed algorithm. The preflood parameter controls how <em>strict</em> or <em>liberal</em> the extraction of these models is performed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">extract_skull_skin</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subject_name</span><span class="p">,</span> <span class="n">preflood_height</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
<p>Important, watershed extraction results should be manually verified. As the watershed extraction results are used to construct the skull and skin models, their respective plotting routines are also found in this module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">finnpy.src_rec.skull_skin_mdls</span>

<span class="n">skull_skin_mdl</span> <span class="o">=</span> <span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">,</span> <span class="s2">&quot;MEG&quot;</span><span class="p">)</span>
<span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">skull_skin_mdls</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">skull_skin_mdl</span><span class="p">,</span> <span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Another subject specific step is the computation of a seghead models. This may be performed as indicated below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">freesurfer</span><span class="o">.</span><span class="n">calc_head_model</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, if the data is to be transformed from a subject specific into fs-average space (if desired), the following line of code may be performed herein to speed up later computations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">finnpy</span><span class="o">.</span><span class="n">src_rec</span><span class="o">.</span><span class="n">subj_to_fsavg</span><span class="o">.</span><span class="n">prepare</span><span class="p">(</span><span class="n">anatomy_path</span><span class="p">,</span> <span class="n">subj_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Importantly, if maintainable (memory-wise), subjects should be processed in parallel to minimize computation time. As such, the entire herein discussed part of the reconstruction pipeline may be easily parallelized on the outside, for example using finnpys timed pool for multithreading (finnpy.misc.timed_pool).</p>
<p>This concludes the MEG subject specific part of the source reconstruction pipeline. The next step (MEG recording specific) is explained in <a class="reference internal" href="src_rec_recording.html#src-rec-recording-label"><span class="std std-ref">MEG recording specific model computation</span></a>.</p>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../../_sources/source/guides/src_rec_subject.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022, Maximilian Scherer.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.0.2.
    <br/>
  </p>
</div>
      
        <div class="footer-item"><div class="injected">
  <div class="rst-versions " data-toggle="rst-versions" role="note"
    aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">&nbsp;&nbsp;Other versions&nbsp;&nbsp;</span>
      v: develop
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Branches</dt>
        <dd class="rtd-current-item">
          <a href="../../../develop/index.html">develop</a>
        </dd>
        <dd class="">
          <a href="../../../stable/index.html">stable</a>
        </dd>
      </dl>
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            <form id="flyout-search-form" class="wy-form" target="_blank" action="../../
              ../develop/index.html/../search.html" method="get">
              <input type="text" name="q" aria-label="Search docs" placeholder="Search docs">
            </form>
          </div>
        </dd>
      </dl>
    </div>
  </div>
</div></div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>